require './lib/fintecture'

# Fintecture.environment = 'test'
# Fintecture.app_id = '8603fb08-d2ef-4e73-ba2f-5e4cd80efb65'
# Fintecture.app_secret = '6c892fbb-15c1-42ec-9296-bbbdf89ffd5d'
# Fintecture.private_key = %q(-----BEGIN PRIVATE KEY-----
# MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCmfvSia9VTtjMt
# iFHAP4cE2VYHKGoG+NRz5ciYbsI41jh3eSVwA6aFmOZBb0gXMEvCQZZeNWe4/2LO
# tt3BJLQw9jcLnFQ0P8lhJv4octf+CSLFM34WTkSImsDiKpUgbbo7BUaqYzRShUAc
# SjXlP5zUL7z0a99pPnXAFQzV66vyeVa0IoP2cSbFYAfAY9mp/5lbJQvOsXLA/ay9
# mTNk1u21OFLYfzuta+WJRhFJc05Prb21hd2+Yk+A7S1MkMbFCw5r8rXN9E9iVFcn
# BBPveDGDfSC29n4ZMD/xPjfALXzkfBhukeJwHEIVFhBr3CkVUtSZOpA+Wl4zCGJx
# QknJKOM7AgMBAAECggEAOUSFxLAuikKrS8gNxoCTYnmW+5NNFOTVvp+U5cmDCKW2
# enGzDNpUlrNGz88FDuTPyhthKzpXWOyPAecoU1zaldS6jkXROL+P9tjApw0JehmO
# WiIiBm4ZaJtCKQjYjnTvj4l7CvRgdNnceV6VNyswOFPLPI82Iy8WtWEILzSGyjmg
# Fsrw7WpCKSgzfenoI0Lnz6osQnRf5vHpWqm/NSX4qPuhDsODLI60Z9v2FehTvR8J
# JgHtXm6Eb3jfQh2VunLWFCv0zG9qT1jOATfRZXiEUozwBaX925d8yADqPMjl56vc
# 1tyb6L+EDxPBubUzqkwc5t9HuWtlwQfJRAaAfcRNgQKBgQDWZHNBZu7lMlf7VlCt
# ccKu6hcGl0WxWAqaD6dnTIfu4x96zHjypDBHvtKTgTcOun048Lwwx+10DDUbOcPw
# uFOU7uEoitfL8l3S41ah5dCVulfHMSRqZBUmnKQIgh2gQYAW4MpzzK3yOfC3QdKn
# UQjJ7C2thPgwr5FVn85RXjPD2wKBgQDGzuOplVr3mq6Bf9dHDalhs7ICnrxiFy8r
# KGDvJ2ZBfuU9OsjS/rfS3XU32Y+QcqgfgGiykZyBK9ciR4fQB8JB4BMnRo+0wv1W
# hRIaax4sbwdLLx/UaR109g0E/9Z1N5lnByoW4c7Jy9bdf0Ti3wZvCMOVYL54gez/
# Ar5CXmksIQKBgDtnY+QYUFNjaqtylDIq1kW/CRhDbAUinvVnJvxhYTzY480TwOOC
# iPooLpK+d/H1zGKtmYduriW8iC5+CAO4HziiI/Mm3XpeMo8PfN6pHe2Oz2ma/TsZ
# dh7Xwj+1Rd40p/gu2wnRCdWXJlKww1ynAGdqsJFmyZo722o9OF6lWnSHAoGAH7D1
# K6BKWvQGY1BMsd/ko1Vwx+gj4YMOmtOZ+CWQsFoZEtSfFLtT9EInIFsG/qC4WiUv
# C2AY0aJ6bdV3OdsyxSuCAh3GZKs8lSErTJjMu4qLYBnH+iUzc+SRGL3ros3VH05O
# EE24mARtYOubwIqKzQJZoyND2ZPkgpYeXBgOreECgYEAg0+lcBaN02yalOLalCDz
# yBda7xpfvnEYv1VUK/Hb4g9hD8KBciTr1OZo82Mjv7uC0ToBq9vDFmVXV4AbIIl7
# z/ZLU1tK4wJqXqKBEz+mzapJZpo9tzxrg7pg8VJG/a58fplraTchL6N6PFL/DEY9
# 02CGyNOpy9nTApObcTv1sPw=
# -----END PRIVATE KEY-----)
# 
Fintecture.environment = 'local'
Fintecture.app_id = '4654b076-7ed5-43d2-9fb9-40d48b05bf92'
Fintecture.app_secret = '2ab2eba3-7106-45a9-a0cc-3eda0d45ffc1'
Fintecture.private_key = %q(-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCRzz6FzaNDUraa
qh2vD7gqcGNskZOpEDTHiWqj7fXeirPDKbOPdwuRKjf+Dc2VFrzLs7sCGjv233ay
xIMWGWVCXg2HvRfkF1qh+zlz09c7nY2C1TJ+jw5AkR90opCtcvVAt8N14GtwQPXX
vCDw925/qIVU1JQHJsCS6XB10KWpdb+UzZxuZwruTw66+gx9njAyg9o/9mOIRJGQ
fc2YTvlsfw+NiVQiwvjBrklXtN6cIiZIyH6PxhQg73zcceWlTqfokcxWl+wyZjIJ
ReApYUPKihDAVDD+PKsv2j5J6/Bt0BQIfGCVVhqYqpcP5Xe+VMDyD5H2j3OYjjI5
noiAdNvBAgMBAAECggEACpeUXPz6F2RqqSP4LGTxxdIh7tueb0F4TBHSojOhpk0g
z5R3xlFpZjNmcOQIzgP3qrvqNwtigBsYpiuPXZYdBywKQz+R0jsowCvzWajccai5
hHUUtMvonE55NgGvN+JqKDg75elryfJLdE9m0d/E8ldyzshIiUJ1P9bfGWKS/j3Y
SQEqzmPfr8xPsmScxuwEH7qgobI1D0xCIU4dzMKj3sYxEN2XcSUyzQ7kMtvgVenQ
gJ+o9xMc3pcmTB/v+u26l5PvMuUEq4SkepfOt8xXSCCYBEQYNdJgmD+AV0hhmqyJ
NQbxl/OsYXdzkiPL+SEBt9z3i/iQ5XdoosbK3DeSaQKBgQDELuhbYPzgFeHSSlT5
jMztP3C+H9rebC0S0o1owiQIdgOvt4Q/gB+TCvxnhSum7Bta5PrII5UW+35X/Q/G
D61YchMpF5XmSsBT9mR1mxtQa+VfO3xeR6aOrS/nRhJodRsMZTaGx5oAuA/mw+zT
7L+A6IpKF5JahXlEygnt5GfUXQKBgQC+RGp+XhAs9c3mkqp6V7QbCZUqSTKzLJnD
Cb6Tzd9El42MiRTYnzLBsehiXnuaTIyOnysOYZN+Tgw/KU6rj3racDOw/nzVxuJH
1K/JKX4A939JhbKK2e/TXVnyIdxMKj3b/Ud7/rBaF3X4IaIByheDJtoxFX+gvWNy
edrU+D8utQKBgEuNYRCn9lr6MmCBHd6JOfZ4QxwFOo4EDQu9qJXahnP3tw252CV4
WzCOv4vCfoAnV5WWr3naMjWKnyqVm7iEGxb/v59IpQLucMklD6U3GbrMAqa9SvUo
FN3HlrYzhy1RRBxu8iPPxOBYAk+1zoQDHfEwHOnR0BwqYPx77nz+RHpFAoGBALMY
gUmLzxwTEApeuhvJHF5q6b7RAelILUA6lupX2jadlX7Ytgel6sgKZ9zYZO576b6C
MqwpywUUAFEf186Dkze0b+PF2Mn9mJfWqtTmupW8YlNZhxNOS4Igl/7kQpJrHKlL
wxMDTQqwlLnJJs8aZIFue+nB+83ZF5f0/biEKC0VAoGAF5LVX7kBeYE8uYpgM3Of
4mDWpf6iBsZsWWLdz1KkTUQQe+1D75hCe9rnl9rHvw8MWQyjtxjCyI7W9ueF0f1l
0l9/4zNxstLm1eFNaMZIChYpNx7lIcBLwjuJkW+vIe1iQAOStGDbXOT+CmPk369b
zS/9VwFGcJrUsVzzD40dhic=
-----END PRIVATE KEY-----)



payment_attrs = {
    amount: 123,
    currency: 'EUR',
    communication: 'Thanks Mom!',
    customer_full_name: 'John Doe',
    customer_email: 'john.doe@email.com',
    customer_ip: '127.0.0.1',
    customer_phone: '666777888',
    customer_address: {
        street: 'Main St.',
        number: '123',
        complement: '2nd floor',
        zip: '75000',
        city: 'Paris',
        country: 'fr',
    },
    redirect_uri: 'http://www.google.fr',
    origin_uri: 'http://example.com/checkout?session=123',
    state: 'somestate',
    psu_type: 'retail',
    country: 'fr',




    # beneficiary: {
    #     name: "Bob Smith",
    #     street: "road of somewhere",
    #     number: "2",
    #     city: "Paris",
    #     zip: "93160",
    #     country: "FR",
    #     iban: "FR1420041010050500013M02606",
    #     swift_bic: "BANKFRXXXXX"
    # }
}


@tokens = Fintecture::Pis.get_access_token
# puts "
#     token
# "
# puts @tokens

@connect_response = Fintecture::Connect.get_pis_connect @tokens['access_token'], payment_attrs
url = @connect_response[:url]
puts url




while true

    payment_response = Fintecture::Pis.get_payments @tokens['access_token'], @connect_response[:session_id]

    payment_response_body = JSON.parse payment_response.body
    # puts payment_response_body.to_json

    verified = (payment_response_body['meta']['status'] === 'payment_created')
    puts verified

    sleep 5
end