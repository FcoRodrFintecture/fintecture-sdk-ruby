require './lib/fintecture'

# Fintecture.environment = 'test'
# Fintecture.app_id = '8603fb08-d2ef-4e73-ba2f-5e4cd80efb65'
# Fintecture.app_secret = '6c892fbb-15c1-42ec-9296-bbbdf89ffd5d'
# Fintecture.private_key = %q(-----BEGIN PRIVATE KEY-----
# MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC5GnIf2z104zO/
# +i0n3cBuRHpkUHM36xI9Uf1JV/UTEYzzAo1u/+XXxsnLDcaSjm+zca+zJFjK4yae
# TgL7esn+Cdngy311huDBzkIf0wRCNmtyj8FyYkbNhFLPot3YFZGhy4em+AtwvQQU
# 0eo9BLhJJd33apJhHJfj27dOjSxcIrMtno6YyihskbX0DB1xLVZdoL22NbZmnZqH
# C5ZXV5qOFWhNOiT1YKh2Yd88XQnYAFwmWWS95SuEY65n+QR2a6wh7RwjHvgDOErf
# ms96Hp0cjhWFuZJ39WDMHvGyjJ+buRKLMlSWyx/Ft84QiT59mIKipzR59eAJ351X
# B91hOwCvAgMBAAECggEAGjMADDo/zJeL75Q9Z/MfFXxjxmcMp9GB12QPcZ4ddgF5
# 7btiwV8+7PeaAD+G5595d/CTacuvNahJAwcPrQCILoi+ae7jZwscLNJA0bhQVf7V
# 3nUycDoww04DWpg2xirnXfsszBk3pVFbjobXnKNaYiAV9rsC1PPzG7ExlNCugqu4
# PSoKVU7HTM+8YDPEpHeT9z3uIV7zFzgNq1+/dIg0GBZZM4U9Qe+OztroRnfb1BT6
# WIqAxCExfBa2GHSAlJFS0+NmVwcoKWRCsmUH6ISj4SiiJvVJfIca0/GqycBqKzvQ
# TOQh3c+IrXyG2ssiK9Nb6lqBGviHhB3p6C6tF4wPQQKBgQD/pG3JiC7cAOq5Afae
# MFZ9STfIRfd/pocrZByEduoc9pkAprhv4KU1M+ARJ+M1Svg74lAv9ULd1aoSONf3
# +NQbdbNJBFXSoS/YylKDJNYM0Yrfu+ku+1/m6kPNIg82EtMYB+Li1eAYAa4x/gJw
# RsNEiZHWpF0Zgy+hSn+vtrocSQKBgQC5XL/2baMCW8hLNy+GwONrtqJvcPxoQbZC
# AHPLN8Hsau4vE/LWjXqhHc82ze5zoMUNA/wk0Ic2dvixu87HInc8oXTSuNorN/Y6
# e4Nnqu7Nu2C7Q5eieHupfNVTt8/EZb0lb6YGus7PxMbsWK5o5xZhmNnhRWERr35A
# i3eVmCWFNwKBgQCxM9U2QUPaFHifzZCZjoAlUD9uf7FTtqczmK171MHrWbQtE2P9
# iQZ7nn3O5otEQbdYK0PSOnwjMRw2jViG9uBwOGISVwL2geycpYIUjdAiCo3tEGBO
# xMhxVCmzY8yPevUAT1ciTYaMnX2WAbDHCwYH2CRTWJOAP8MgVnez4UGYoQKBgAbj
# FlLOogbdaCS7SS3Fju2anJBtb0NkZaQwJh0/1hm1o2HmaNhl609/LwrHPfvX1lp0
# cnLfuJZidz0LUFR/yFRdX1zQ93IxoxlrK2e3pyXHt4Fdso2b0mRqufZhVvviF9QD
# QPTxDewUUJvJc7l8FI3NwxKmpEOm9JbrV6ccPxCjAoGAJ8uwnsH27gzzFxsf1Frc
# OYFOw3vyqw1pd6I4uIq7vWtqT4GAmwL2lzEanTMsuFY/rRkSRrTR8hLZPmFZM5zs
# qZfkZDAuZEuZEj4gE1YExhRYshyWWXN8NdkW1DITGSksUttGK+eM4ZsfMbnt8ibV
# RySRy3s2FItWMAOF1KvDZkA=
# -----END PRIVATE KEY-----)

Fintecture.environment = 'local'
Fintecture.app_id = 'cab8f065-55f2-4660-98e4-07835380f762'
Fintecture.app_secret = '902426e1-12e7-437e-9779-e63ee6da5c09'
Fintecture.private_key = %q(-----BEGIN PRIVATE KEY-----
MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDnDfg9CWRv0h5s
6pJTM7Bsd5XzztAv1dp8QQPG+hQl+s+WtpHm/6kMqag8RJPFQx+hPE1MsGYzrEsx
zejjyNBKPG9em1qQzJiQmuc22Pbq0koYCKterRgQGp9zbiYFJEpILrZ1opMBFV6M
sbKFkYl0m4inSnewYG4ISEop9nkcyb1wYVKK8joTrN04xKqWlElV+gyoFoPhi2r8
V+l+ubzGJiOdXQJA1sBA/umoxbZCgX3JhtTOpz2FQETvYiSomGEMQdpo3vjlL/EV
8R1fSN8HzYv3xyDlbdvJPmMnvYNMNlpMSAt6Ft4duF0xp5JYMA9hrfny1u8wQ8BY
DMl1pVsRAgMBAAECggEAUSpZH6fi/l0DjyM/z7aCrTe9F255N7SaEbgNCaLj3Quk
TL9JtantyqL2lGVKu6r+u3cheGUnIdPOfmpk+0+Zy9o7DTLpt6AHoBSqUFwbMRY6
LQMuoA2SPGX9yWDSPlAnQAAY3G4F0gWdtzLdEYq0jJ/ue0XvkafuPz6VvvP0S6Xv
5FmItpPjTGz3r+Vh0AbqxWLppLdACMJSF3x+jz0JRuvRBPMw3VDKxel7X0mydnYC
LxsmuBHIb3Pf06iMw3NtvFzI1on6wO53YCAcdr3rXxYsweFgXgBkfxwC2oGtrO2m
obs8nuLfiZcR5hrLDhlNlofjYiQxmxfUkk0T7H/JWQKBgQD0nBt1tuzf0ft1ozAS
5MtJQd7ShoC7qOwwJ7wYHkqUaOJP+AtX3hFR+G0Es0WfUcyCojxQ8qMYR2U1zo+n
pllRrj872juLhEvwJ1r2wYdOnk9+bvhMuinavJ02gl6pgU33acD9ODJCBy1UwoTY
3VeyXEMFtovCeJePKSNY8qAtIwKBgQDx0EayJjCFYC42RP6W95ZOsTAqUq4gSjWm
I4Ibv7aQM5NmkwNzcsmcYNpKzsqjtxQ0L4bxJ0qpYCVNiafOS2Pl2SUk5FGG1Sr9
MGvjmU3ORX3VC5NEtVITg4ROzNyz3gqSy7vCdqalPuEEVDfRJ7WmnSRjhaqyUZOw
FLev4Ip8OwKBgQCZT86WNRS6I+4riSB0dxpCzBpQcST2eaWvePgXVcUAx8wwuxLA
+9p3OfF6ZLJabPZ1WiHbyngWm4j/9HttZIHPBBt19A4mH8FIwCHvTtTznZ3NbNgL
nxLkmhsfMw8JxpWLYKkpDLPTVpQ+77w8AF8a12Daj9OBC/xSKkKRWWCzaQKBgQDV
Tod+UOfOT6iUIMp/u4lwgybcvrBxNWUb2AjGl5fgnk5xVk/eACzOcDU/dikUv8Pn
wOEFS0a2IGTnf/1xodlOgP0eDPXJvbK9Q4B4ddxHj89PJnXTTytGoWYN6PLrC3xC
P8ux395iuBPgMLZIHwJDJi1aSSfpQsLHuY7La4RdzwKBgQCepT0DEmtCEPsfsTEv
6nrmrHkyCpzJk+1qPqIf1yafdGYOnQsK8nqQILMCdY5XKQaj+95ffuyddL9EGhD7
LI08GQvC8jiir0zZtk0ooA74VNIPWLldLIqH5iuRr+YjENkczDOkRJntjXhpjyVR
8KOst79FhQYYu+m6ip0y1y/Xog==
-----END PRIVATE KEY-----)



payment_attrs = {
    amount: 123,
    currency: 'EUR',
    communication: 'Thanks Mom!',
    customer_full_name: 'John Doe',
    customer_email: 'john.doe@email.com',
    customer_ip: '127.0.0.1',
    customer_phone: '666777888',
    customer_address: {
        street: 'Main St.',
        number: '123',
        complement: '2nd floor',
        zip: '75000',
        city: 'Paris',
        country: 'fr',
    },
    redirect_uri: 'http://www.google.fr',
    origin_uri: 'http://example.com/checkout?session=123',
    state: 'somestate',
    psu_type: 'retail',
    country: 'fr',




    # beneficiary: {
    #     name: "Bob Smith",
    #     street: "road of somewhere",
    #     number: "2",
    #     city: "Paris",
    #     zip: "93160",
    #     country: "FR",
    #     iban: "FR1420041010050500013M02606",
    #     swift_bic: "BANKFRXXXXX"
    # }
}


@tokens = Fintecture::Pis.get_access_token
# puts "
#     token
# "
# puts @tokens

@connect_response = Fintecture::Connect.get_pis_connect @tokens['access_token'], payment_attrs
# url = @connect_response[:url]
# puts url




# while true

#     payment_response = Fintecture::Pis.get_payments @tokens['access_token'], @connect_response[:session_id]

#     payment_response_body = JSON.parse payment_response.body
#     # puts payment_response_body.to_json

#     verified = (payment_response_body['meta']['status'] === 'payment_created')
#     puts verified

#     sleep 5
# end